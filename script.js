// Translation Dictionary
const translations = {
  tr: {
    // Navigation
    nav_about: "Hakkımızda",
    nav_services: "Hizmetler",
    nav_contact: "İletişim",
    btn_track: "Kargo Takip",
    btn_quote: "Teklif Al",

    // Hero
    hero_title: "İşinizi Dünyaya Bağlıyoruz",
    hero_subtitle:
      "Hava, Deniz, Kara ve Depolama için uçtan uca lojistik çözümleri",
    hero_btn_services: "Hizmetleri Keşfet",
    hero_btn_quote: "Teklif Al",

    // Quote Form
    quote_title: "Hızlı Teklif Alın",
    quote_subtitle: "Bilgilerinizi doldurun, 24 saat içinde size dönüş yapalım",
    form_name: "Ad Soyad *",
    form_email: "E-posta Adresi *",
    form_phone: "Telefon Numarası *",
    form_service_type: "Hizmet Türü *",
    form_select_service: "Hizmet seçiniz",
    form_submit: "Teklif Talebi Gönder",
    form_success:
      "Teşekkürler! Teklif talebiniz başarıyla gönderildi. 24 saat içinde sizinle iletişime geçeceğiz.",

    // Services
    services_title: "Hizmetlerimiz",
    services_subtitle: "İhtiyaçlarınıza özel kapsamlı lojistik çözümleri",
    service_air: "Hava Taşımacılığı",
    service_air_desc:
      "Zamana duyarlı gönderileriniz için hızlı ve güvenilir hava kargo çözümleri.",
    service_sea: "Deniz Taşımacılığı",
    service_sea_desc:
      "Büyük ve ağır kargo gönderileri için uygun maliyetli deniz taşımacılığı hizmetleri.",
    service_land: "Kara Taşımacılığı",
    service_land_desc:
      "Yurt içi ve uluslararası güzergahlarda verimli karayolu taşımacılığı çözümleri.",
    service_project: "Proje Taşımacılığı",
    service_project_desc:
      "Büyük boyutlu, ağır yük ve projeye özel kargolar için uzman taşımacılık.",
    service_warehouse: "Depolama",
    service_warehouse_desc:
      "Modern envanter yönetimi ile güvenli depolama ve dağıtım çözümleri.",
    learn_more: "Daha Fazla",

    // Why Choose Us
    why_title: "Neden Bizi Tercih Etmelisiniz",
    why_subtitle: "Küresel lojistikte güvenilir iş ortağınız",
    value_fast: "Hızlı",
    value_fast_desc:
      "Kısa teslim süreleri ve hızlandırılmış gönderim seçenekleri",
    value_ontime: "Zamanında",
    value_ontime_desc: "Tüm hizmet türlerinde %95+ zamanında teslimat oranı",
    value_reliable: "Güvenilir",
    value_reliable_desc: "Dünya genelinde binlerce işletmenin güvendiği firma",
    value_global: "Küresel Ağ",
    value_global_desc: "50'den fazla ülkeyi kapsayan geniş ağ",

    // Stats
    stat_deliveries: "Başarılı Teslimat",
    stat_countries: "Ülke",
    stat_experience: "Yıllık Deneyim",
    stat_satisfaction: "Müşteri Memnuniyeti %",

    // Footer
    footer_desc:
      "Global Logistics, kapsamlı taşımacılık ve lojistik çözümleri için güvenilir iş ortağınızdır. Dünya genelinde işletmeleri güvenilir, verimli ve uygun maliyetli nakliye hizmetleriyle buluşturuyoruz.",
    footer_quick_links: "Hızlı Bağlantılar",
    footer_faq: "SSS",
    footer_contact: "İletişim Bilgileri",
    footer_address: "123 Lojistik Caddesi, İş Merkezi, İstanbul, Türkiye",
    footer_copyright: "© 2024 Global Logistics. Tüm hakları saklıdır.",
    footer_privacy: "Gizlilik Politikası",
    footer_terms: "Kullanım Koşulları",
    footer_cookies: "Çerez Politikası",

    // Tracking Modal
    track_title: "Kargonuzu Takip Edin",
    track_desc:
      "Gönderi durumunuzu gerçek zamanlı takip etmek için takip numaranızı girin.",
    track_placeholder: "Takip numarasını girin...",
    track_btn: "Takip Et",
    track_info: "Takip Bilgileri",
    track_received: "Gönderi Teslim Alındı",
    track_received_desc: "Paket çıkış tesisinde teslim alındı",
    track_transit: "Yolda",
    track_transit_desc: "Paket varış noktasına doğru yolda",
    track_delivery: "Dağıtıma Çıktı",
    track_delivery_desc: "Paket dağıtıma çıktı",
    track_expected: "Tahmini",

    // Validation Messages
    val_name_required: "Lütfen adınızı ve soyadınızı girin",
    val_name_min: "İsim en az 2 karakter olmalıdır",
    val_email_required: "Lütfen e-posta adresinizi girin",
    val_email_invalid: "Lütfen geçerli bir e-posta adresi girin",
    val_phone_required: "Lütfen telefon numaranızı girin",
    val_phone_invalid: "Lütfen geçerli bir telefon numarası girin",
    val_service_required: "Lütfen bir hizmet türü seçin",

    // Notifications
    lang_changed: "Dil Türkçe olarak değiştirildi",
  },
  en: {
    // Navigation
    nav_about: "About Us",
    nav_services: "Services",
    nav_contact: "Contact",
    btn_track: "Track Cargo",
    btn_quote: "Get a Quote",

    // Hero
    hero_title: "Connecting Your Business to the World",
    hero_subtitle:
      "End-to-end logistics solutions for Air, Sea, Land, and Warehousing",
    hero_btn_services: "Explore Services",
    hero_btn_quote: "Get a Quote",

    // Quote Form
    quote_title: "Get a Quick Quote",
    quote_subtitle:
      "Fill in your details and we'll get back to you within 24 hours",
    form_name: "Full Name *",
    form_email: "Email Address *",
    form_phone: "Phone Number *",
    form_service_type: "Service Type *",
    form_select_service: "Select a service",
    form_submit: "Submit Quote Request",
    form_success:
      "Thank you! Your quote request has been submitted successfully. We'll contact you within 24 hours.",

    // Services
    services_title: "Our Services",
    services_subtitle:
      "Comprehensive logistics solutions tailored to your needs",
    service_air: "Air Freight",
    service_air_desc:
      "Fast and reliable air cargo solutions for time-sensitive shipments worldwide.",
    service_sea: "Sea Freight",
    service_sea_desc:
      "Cost-effective ocean freight services for large and heavy cargo shipments.",
    service_land: "Land Freight",
    service_land_desc:
      "Efficient ground transportation solutions across domestic and international routes.",
    service_project: "Project Cargo",
    service_project_desc:
      "Specialized handling for oversized, heavy-lift, and project-specific cargo.",
    service_warehouse: "Warehousing",
    service_warehouse_desc:
      "Secure storage and distribution solutions with modern inventory management.",
    learn_more: "Learn More",

    // Why Choose Us
    why_title: "Why Choose Us",
    why_subtitle: "Your trusted partner in global logistics",
    value_fast: "Fast",
    value_fast_desc: "Quick turnaround times and expedited shipping options",
    value_ontime: "On-Time",
    value_ontime_desc: "95%+ on-time delivery rate across all service types",
    value_reliable: "Reliable",
    value_reliable_desc: "Trusted by thousands of businesses worldwide",
    value_global: "Global Network",
    value_global_desc: "Extensive network spanning 50+ countries",

    // Stats
    stat_deliveries: "Successful Deliveries",
    stat_countries: "Countries",
    stat_experience: "Years Experience",
    stat_satisfaction: "Customer Satisfaction %",

    // Footer
    footer_desc:
      "Global Logistics is your trusted partner for comprehensive freight forwarding and logistics solutions. We connect businesses worldwide with reliable, efficient, and cost-effective shipping services.",
    footer_quick_links: "Quick Links",
    footer_faq: "FAQ",
    footer_contact: "Contact Info",
    footer_address: "123 Logistics Street, Business District, Istanbul, Turkey",
    footer_copyright: "© 2024 Global Logistics. All rights reserved.",
    footer_privacy: "Privacy Policy",
    footer_terms: "Terms of Service",
    footer_cookies: "Cookie Policy",

    // Tracking Modal
    track_title: "Track Your Cargo",
    track_desc:
      "Enter your tracking number to get real-time updates on your shipment.",
    track_placeholder: "Enter tracking number...",
    track_btn: "Track",
    track_info: "Tracking Information",
    track_received: "Shipment Received",
    track_received_desc: "Package received at origin facility",
    track_transit: "In Transit",
    track_transit_desc: "Package is in transit to destination",
    track_delivery: "Out for Delivery",
    track_delivery_desc: "Package is out for delivery",
    track_expected: "Expected",

    // Validation Messages
    val_name_required: "Please enter your full name",
    val_name_min: "Name must be at least 2 characters",
    val_email_required: "Please enter your email address",
    val_email_invalid: "Please enter a valid email address",
    val_phone_required: "Please enter your phone number",
    val_phone_invalid: "Please enter a valid phone number",
    val_service_required: "Please select a service type",

    // Notifications
    lang_changed: "Language changed to English",
  },
};

// Current language (default: Turkish)
let currentLang = "tr";

// Apply translations to all elements with data-i18n attribute
function applyLanguage(lang) {
  currentLang = lang;
  const dict = translations[lang];
  if (!dict) return;

  document.documentElement.lang = lang;

  document.querySelectorAll("[data-i18n]").forEach((el) => {
    const key = el.getAttribute("data-i18n");
    if (dict[key] === undefined) return;

    // For elements that contain child icons, preserve them
    const icon = el.querySelector("i.fas, i.fab");
    if (icon) {
      el.textContent = dict[key] + " ";
      el.appendChild(icon);
    } else {
      el.textContent = dict[key];
    }
  });

  // Update page title
  document.title =
    lang === "tr"
      ? "Global Logistics - İşinizi Dünyaya Bağlıyoruz"
      : "Global Logistics - Connecting Your Business to the World";

  // Store preference
  localStorage.setItem("preferred_lang", lang);
}

// DOM Elements
const header = document.getElementById("header");
const navToggle = document.getElementById("navToggle");
const navMenu = document.getElementById("navMenu");
const quoteForm = document.getElementById("quoteForm");
const formSuccess = document.getElementById("formSuccess");
const trackCargoBtn = document.getElementById("trackCargoBtn");
const getQuoteBtn = document.getElementById("getQuoteBtn");
const languageSelect = document.getElementById("languageSelect");

// Mobile Menu Toggle
navToggle.addEventListener("click", () => {
  navToggle.classList.toggle("active");
  navMenu.classList.toggle("active");

  // Prevent body scroll when menu is open
  if (navMenu.classList.contains("active")) {
    document.body.style.overflow = "hidden";
  } else {
    document.body.style.overflow = "";
  }
});

// Close mobile menu when clicking on a link
document.querySelectorAll(".nav__link").forEach((link) => {
  link.addEventListener("click", () => {
    navToggle.classList.remove("active");
    navMenu.classList.remove("active");
    document.body.style.overflow = "";
  });
});

// Sticky Header on Scroll
let lastScrollTop = 0;
window.addEventListener("scroll", () => {
  const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

  // Add scrolled class to header
  if (scrollTop > 100) {
    header.classList.add("header--scrolled");
  } else {
    header.classList.remove("header--scrolled");
  }

  lastScrollTop = scrollTop;
});

// Smooth Scrolling for anchor links
document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
  anchor.addEventListener("click", function (e) {
    e.preventDefault();
    const targetId = this.getAttribute("href");

    if (targetId === "#") return;

    const targetElement = document.querySelector(targetId);
    if (targetElement) {
      const headerHeight = header.offsetHeight;
      const targetPosition = targetElement.offsetTop - headerHeight - 20;

      window.scrollTo({
        top: targetPosition,
        behavior: "smooth",
      });
    }
  });
});

// Form Validation and Submission
quoteForm.addEventListener("submit", (e) => {
  e.preventDefault();

  // Get form data
  const formData = new FormData(quoteForm);
  const name = formData.get("name").trim();
  const email = formData.get("email").trim();
  const phone = formData.get("phone").trim();
  const serviceType = formData.get("serviceType");

  // Validation
  let isValid = true;
  let errorMessage = "";

  // Reset previous error states
  document.querySelectorAll(".form-input, .form-select").forEach((field) => {
    field.classList.remove("error");
  });

  const t = translations[currentLang];

  // Name validation
  if (!name) {
    showError("name", t.val_name_required);
    isValid = false;
  } else if (name.length < 2) {
    showError("name", t.val_name_min);
    isValid = false;
  }

  // Email validation
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!email) {
    showError("email", t.val_email_required);
    isValid = false;
  } else if (!emailRegex.test(email)) {
    showError("email", t.val_email_invalid);
    isValid = false;
  }

  // Phone validation
  const phoneRegex = /^[\d\s\-\+\(\)]+$/;
  if (!phone) {
    showError("phone", t.val_phone_required);
    isValid = false;
  } else if (!phoneRegex.test(phone) || phone.length < 10) {
    showError("phone", t.val_phone_invalid);
    isValid = false;
  }

  // Service type validation
  if (!serviceType) {
    showError("serviceType", t.val_service_required);
    isValid = false;
  }

  if (isValid) {
    // Show success message
    quoteForm.style.display = "none";
    formSuccess.style.display = "block";

    // Log form data (in a real application, this would be sent to a server)
    console.log("Form submitted:", {
      name,
      email,
      phone,
      serviceType,
      timestamp: new Date().toISOString(),
    });

    // Reset form after 5 seconds
    setTimeout(() => {
      quoteForm.reset();
      quoteForm.style.display = "block";
      formSuccess.style.display = "none";
    }, 5000);
  }
});

// Show error for form field
function showError(fieldName, message) {
  const field = document.getElementById(fieldName);
  field.classList.add("error");

  // Create or update error message
  let errorElement = field.parentNode.querySelector(".error-message");
  if (!errorElement) {
    errorElement = document.createElement("span");
    errorElement.className = "error-message";
    errorElement.style.color = "#ef4444";
    errorElement.style.fontSize = "0.875rem";
    errorElement.style.marginTop = "0.25rem";
    errorElement.style.display = "block";
    field.parentNode.appendChild(errorElement);
  }
  errorElement.textContent = message;

  // Remove error on input
  field.addEventListener(
    "input",
    () => {
      field.classList.remove("error");
      if (errorElement) {
        errorElement.remove();
      }
    },
    { once: true },
  );
}

// Counter Animation for Stats
function animateCounters() {
  const counters = document.querySelectorAll(".stat-number");
  const speed = 200; // Animation speed

  counters.forEach((counter) => {
    const target = parseInt(counter.getAttribute("data-target"));
    const increment = target / speed;
    let current = 0;

    const updateCounter = () => {
      current += increment;

      if (current < target) {
        counter.textContent = Math.ceil(current);
        requestAnimationFrame(updateCounter);
      } else {
        counter.textContent = target;
      }
    };

    updateCounter();
  });
}

// Intersection Observer for counter animation
const statsObserver = new IntersectionObserver(
  (entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        animateCounters();
        statsObserver.unobserve(entry.target);
      }
    });
  },
  {
    threshold: 0.5,
  },
);

// Start observing stats container
const statsContainer = document.querySelector(".stats-container");
if (statsContainer) {
  statsObserver.observe(statsContainer);
}

// Track Cargo Button
trackCargoBtn.addEventListener("click", () => {
  // Create a simple tracking modal
  const modal = createTrackingModal();
  document.body.appendChild(modal);

  // Show modal with animation
  setTimeout(() => {
    modal.classList.add("active");
  }, 10);
});

// Get Quote Button (scroll to quote form)
getQuoteBtn.addEventListener("click", () => {
  const quoteSection = document.getElementById("quote");
  if (quoteSection) {
    const headerHeight = header.offsetHeight;
    const targetPosition = quoteSection.offsetTop - headerHeight - 20;

    window.scrollTo({
      top: targetPosition,
      behavior: "smooth",
    });
  }
});

// Language Selector
languageSelect.addEventListener("change", (e) => {
  const selectedLang = e.target.value;
  applyLanguage(selectedLang);
  showNotification(translations[selectedLang].lang_changed);
});

// Create Tracking Modal
function createTrackingModal() {
  const modal = document.createElement("div");
  modal.className = "tracking-modal";
  const t = translations[currentLang];
  modal.innerHTML = `
        <div class="tracking-modal__overlay"></div>
        <div class="tracking-modal__content">
            <button class="tracking-modal__close">&times;</button>
            <h3>${t.track_title}</h3>
            <p>${t.track_desc}</p>
            <form class="tracking-form">
                <input type="text" placeholder="${t.track_placeholder}" class="tracking-input" required>
                <button type="submit" class="btn btn--primary">${t.track_btn}</button>
            </form>
            <div class="tracking-result" style="display: none;">
                <h4>${t.track_info}</h4>
                <div class="tracking-status">
                    <div class="status-item active">
                        <div class="status-icon">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="status-content">
                            <h5>${t.track_received}</h5>
                            <p>${t.track_received_desc}</p>
                            <span class="status-date">2024-01-15 10:30 AM</span>
                        </div>
                    </div>
                    <div class="status-item active">
                        <div class="status-icon">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="status-content">
                            <h5>${t.track_transit}</h5>
                            <p>${t.track_transit_desc}</p>
                            <span class="status-date">2024-01-16 02:15 PM</span>
                        </div>
                    </div>
                    <div class="status-item">
                        <div class="status-icon">
                            <i class="fas fa-truck"></i>
                        </div>
                        <div class="status-content">
                            <h5>${t.track_delivery}</h5>
                            <p>${t.track_delivery_desc}</p>
                            <span class="status-date">${t.track_expected}: 2024-01-17</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;

  // Add styles for modal
  const style = document.createElement("style");
  style.textContent = `
        .tracking-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .tracking-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .tracking-modal__overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .tracking-modal__content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .tracking-modal__close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #64748b;
            transition: color 0.3s ease;
        }
        
        .tracking-modal__close:hover {
            color: #1e293b;
        }
        
        .tracking-form {
            display: flex;
            gap: 1rem;
            margin: 1.5rem 0;
        }
        
        .tracking-input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #cbd5e1;
            border-radius: 0.5rem;
            font-size: 1rem;
        }
        
        .tracking-result {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e2e8f0;
        }
        
        .status-item {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            opacity: 0.5;
            transition: opacity 0.3s ease;
        }
        
        .status-item.active {
            opacity: 1;
        }
        
        .status-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #f1f5f9;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748b;
            flex-shrink: 0;
        }
        
        .status-item.active .status-icon {
            background-color: #22c55e;
            color: white;
        }
        
        .status-content h5 {
            margin-bottom: 0.25rem;
            color: #1e293b;
        }
        
        .status-content p {
            color: #64748b;
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }
        
        .status-date {
            color: #94a3b8;
            font-size: 0.75rem;
        }
        
        @media (max-width: 480px) {
            .tracking-modal__content {
                padding: 1.5rem;
            }
            
            .tracking-form {
                flex-direction: column;
            }
        }
    `;
  document.head.appendChild(style);

  // Handle modal close
  const closeBtn = modal.querySelector(".tracking-modal__close");
  const overlay = modal.querySelector(".tracking-modal__overlay");

  const closeModal = () => {
    modal.classList.remove("active");
    setTimeout(() => {
      document.body.removeChild(modal);
    }, 300);
  };

  closeBtn.addEventListener("click", closeModal);
  overlay.addEventListener("click", closeModal);

  // Handle tracking form submission
  const trackingForm = modal.querySelector(".tracking-form");
  trackingForm.addEventListener("submit", (e) => {
    e.preventDefault();
    const trackingInput = modal.querySelector(".tracking-input");
    const trackingResult = modal.querySelector(".tracking-result");

    if (trackingInput.value.trim()) {
      // Show tracking result (mock data)
      trackingResult.style.display = "block";
      trackingForm.style.display = "none";

      console.log("Tracking number:", trackingInput.value);
    }
  });

  return modal;
}

// Notification System
function showNotification(message, type = "info") {
  const notification = document.createElement("div");
  notification.className = `notification notification--${type}`;
  notification.textContent = message;

  // Add styles for notification
  const style = document.createElement("style");
  style.textContent = `
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background-color: #1e293b;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 3000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            max-width: 300px;
        }
        
        .notification--info {
            background-color: #0ea5e9;
        }
        
        .notification--success {
            background-color: #22c55e;
        }
        
        .notification--error {
            background-color: #ef4444;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        @media (max-width: 480px) {
            .notification {
                right: 10px;
                left: 10px;
                max-width: none;
            }
        }
    `;

  if (!document.querySelector("style[data-notifications]")) {
    style.setAttribute("data-notifications", "true");
    document.head.appendChild(style);
  }

  document.body.appendChild(notification);

  // Show notification
  setTimeout(() => {
    notification.classList.add("show");
  }, 10);

  // Hide notification after 3 seconds
  setTimeout(() => {
    notification.classList.remove("show");
    setTimeout(() => {
      document.body.removeChild(notification);
    }, 300);
  }, 3000);
}

// Initialize on page load
document.addEventListener("DOMContentLoaded", () => {
  console.log("Global Logistics website loaded successfully");

  // Restore saved language preference, default to Turkish
  const savedLang = localStorage.getItem("preferred_lang") || "tr";
  languageSelect.value = savedLang;
  applyLanguage(savedLang);

  // Add loading animation removal
  document.body.classList.add("loaded");

  // Lazy loading for images (if needed)
  if ("IntersectionObserver" in window) {
    const imageObserver = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const img = entry.target;
          img.classList.add("loaded");
          imageObserver.unobserve(img);
        }
      });
    });

    document.querySelectorAll("img").forEach((img) => {
      imageObserver.observe(img);
    });
  }
});

// Add loading styles
const loadingStyles = document.createElement("style");
loadingStyles.textContent = `
    body {
        opacity: 0;
        transition: opacity 0.5s ease;
    }
    
    body.loaded {
        opacity: 1;
    }
    
    img {
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    img.loaded {
        opacity: 1;
    }
`;
document.head.appendChild(loadingStyles);
